#!/bin/bash

FILELIST="/tmp/filelist"
# action for deleting folder containing current file
ACTION='
CMD="rm -r \"$(dirname %F)\"";
echo "$CMD";
eval "$CMD";'

if [[ -z $1 ]]; then
    DIRS=$(pwd)
else
    DIRS=$(echo "$@" | xargs realpath)
fi

DIRS=$(echo "$DIRS" | tr '\n' ' ')

echo "Scanning ${DIRS}"

find $DIRS -type f \
    -iname "*.jpg" -o \
    -iname "*.jpeg" -o \
    -iname "*.png" -o \
    -iname "*.gif" -o \
    -iname "*.bmp" -o \
    -iname "*.tif" -o \
    -iname "*.tiff" \
    > "$FILELIST"

COUNT=$(wc -l "$FILELIST")
echo "Found $COUNT image files."

feh -A "$ACTION" --zoom max --magick-timeout 5 -dZxrSfilename --filelist "$FILELIST" 2>/dev/null

rm "$FILELIST"
