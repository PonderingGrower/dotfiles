#!/bin/bash

PATH="$PATH:$HOME/bin"

# daemonize command and ingore all output
function run {
    restart=false
    # restart service if -r flag is present
    if [[ $1 == '-r' ]]; then
        restart=true
        shift
    fi
    if [[ $1 == '-c' ]]; then
        command_name=$2
        shift 2
    else
        command_name=$1
    fi
    command=$1
    shift
    # get the arguments
    args=$@
    
    printf " - %-20s" "$command_name"
    if $restart; then
        killall $command 2> /dev/null
    fi
    if ! pgrep -f -d ", " $command_name; then
        echo "STARTING"
        nohup $command $args >> ~/.awesome_apps  2>&1 &
    fi
}

####### programs to run ########

cd /tmp

echo "### Keyboard setup"
xinput set-prop 'pointer:USB-HID Keyboard' 316 -0.7
# Caps Lock <-> Esc
run xmodmap ~/.speedswapper
run -r xcape -e 'Control_R=Escape'

echo "### Autostarting programs:"
run urxvtd -q -f -o
run -c nvim urxvtc -title -e nvim

run -r nm-applet
run -r xfce4-power-manager
run -r blueman-applet
run -r pasystray
#run -r synergys

# Small hack for java compatibility
run wmname LG3D
run nitrogen --restore
run autorandr --change
run synclient TouchpadOff=1
run xbindkeys
#run thunar --daemon
#run skype
